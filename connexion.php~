<!-- PAGE DE CONNEXION -->
<p>EAOJEA</p>
<?php
	/* Connexion base de donnée */
	require('co.php');
	echo('ICI');
	/* Vérification entrée mail et mot de passe non vide */
	if(isset($_POST['emailconnex']) and trim($_POST['emailconnex'])!=''
		and isset($_POST['motdepasse']) and trim($_POST['motdepasse'])!=''){
		/* Préparation de la requête SQL */
		$requete = "SELECT * FROM membres where mail = :mail and motdepasse = :mdp ";
		$req = $bd->prepare($requete);
		/* Vérification attaque injection SQL */
		$req->bindValue(':mail',$_POST['emailconnex']);
		$req->bindValue(':mdp',$_POST['motdepasse']);
		/* Variable temporaire pour la vérification, pour la connexion d'un utilisateur */
		$email = htmlspecialchars($_POST['emailconnex'], ENT_QUOTES);
		$motpasse = htmlspecialchars($_POST['motdepasse'], ENT_QUOTES);
		$password = sha1($motpasse);
		/* Execution de la requête SQL */
		$req->execute();
		$res = $req->fetch(PDO::FETCH_ASSOC))
		/* Recherche correspondance */
		echo('ICI2');
		if($res){
			echo('ICI4');
			/* Si on trouve une correspondance */
			if( $email == $res['mail'] and $password == $ligne['motdepasse']){
				echo('ICI3');
				/* Ouverture d'une session */
				session_start();
				/* La variable $_SESSION prend la valeur true */
				$_SESSION['connecte'] = true;
				/* Envoyer à la page Accueil.php */
				header("Location: Accueil.php");
				exit();
			}
		}					
		else
		{	echo('ICI5');
			header("Location: Connexion.php");
			exit();
		}
	}
	else
	{	echo('ICI6');
		header("Location: Connexion.php");
		exit();
	}
	echo('FIN');
?>
